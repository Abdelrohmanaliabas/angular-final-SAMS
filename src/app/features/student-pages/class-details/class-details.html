<div class="student-shell space-y-6" *ngIf="classDetails$ | async as classDetails">
  <!-- Header -->
  <header class="student-card p-6 lift">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div>
        <h1 class="text-3xl font-bold text-[#0F172A] dark:text-[#F8FAFC] mb-2">{{ classDetails.name }}</h1>
        <p class="student-muted flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          {{ classDetails.teacherName }}
        </p>
      </div>
      <div class="flex flex-col items-end gap-2">
        <span
          class="student-pill indigo">
          {{ classDetails.subject }}
        </span>
        <p class="text-sm student-muted flex items-center gap-1">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Next Class: {{ classDetails.nextClassTime }}
        </p>
      </div>
    </div>
    <p class="mt-4 student-muted">{{ classDetails.description }}</p>
  </header>

  <!-- Class Schedule Calendar -->
  <div
    class="student-card overflow-hidden">
    <div class="p-4 border-b border-[var(--student-border)]">
      <h2 class="text-lg font-bold text-[#0F172A] dark:text-[#F8FAFC]">Monthly Schedule</h2>
    </div>
    @if (schedule$ | async; as schedule) {
    <div class="p-4">
      <!-- Weekday Headers -->
      <div class="grid grid-cols-7 gap-2 mb-2">
        @for (day of ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']; track day) {
        <div class="text-center text-xs font-medium student-muted py-2">{{ day }}</div>
        }
      </div>

      <!-- Calendar Grid -->
      <div class="grid grid-cols-7 gap-2">
        @for (day of getCalendarDays(); track day.date) {
        <div
          class="aspect-square border border-[var(--student-border)] rounded-lg p-2 hover:bg-[var(--student-elevated)] transition-colors"
          [class.opacity-60]="!day.isCurrentMonth"
          [ngClass]="day.hasClass ? ['bg-[#E0F2FE]', 'dark:bg-[#1E3A8A]', 'border-[#2563EB]'] : []">
          <div class="text-sm font-medium text-[#0F172A] dark:text-[#F8FAFC]" [class.student-muted]="!day.isCurrentMonth">
            {{ day.dayNumber }}
          </div>
          @if (day.hasClass) {
          <div class="mt-1">
            <div class="text-xs font-semibold text-[#2563EB] dark:text-[#93C5FD]">{{ day.classTime }}</div>
            <div class="text-xs student-muted truncate">{{ day.location }}</div>
          </div>
          }
        </div>
        }
      </div>

      <!-- Legend -->
      <div class="mt-4 pt-4 border-t border-[var(--student-border)]">
        <div class="flex items-center gap-2 text-sm">
          <div class="w-4 h-4 rounded bg-[#E0F2FE] dark:bg-[#1E3A8A] border border-[#2563EB]"></div>
          <span class="student-muted">Class Day</span>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Lessons List -->
  <div class="space-y-4">
    <h2 class="text-xl font-bold text-[#0F172A] dark:text-[#F8FAFC]">Lessons & Resources</h2>

    @for (lesson of classDetails.lessons; track lesson.id) {
    <div class="student-card overflow-hidden">
      <div class="p-4 border-b border-[var(--student-border)] bg-[var(--student-elevated)]">
        <h3 class="font-semibold text-lg text-[#0F172A] dark:text-[#F8FAFC]">{{ lesson.title }}</h3>
        <p class="text-sm student-muted mt-1">{{ lesson.description }}</p>
      </div>

      <div class="p-4 space-y-3">
        @if (lesson.resources.length > 0) {
        @for (resource of lesson.resources; track resource.id) {
        @if (resource.type === 'video') {
        <a [routerLink]="['/dashboard/video']" [queryParams]="{url: resource.url, title: resource.title}"
          class="flex items-center gap-3 p-3 rounded-lg hover:bg-[var(--student-elevated)] transition-colors border border-transparent hover:border-[var(--student-border)]">
          <div
            class="w-10 h-10 rounded-lg flex items-center justify-center shrink-0 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <h4 class="font-medium text-[#0F172A] dark:text-[#F8FAFC]">{{ resource.title }}</h4>
            <p class="text-xs student-muted">Watch Video</p>
          </div>
        </a>
        } @else {
        <a [href]="resource.url" target="_blank"
          class="flex items-center gap-3 p-3 rounded-lg hover:bg-[var(--student-elevated)] transition-colors border border-transparent hover:border-[var(--student-border)]">
          <div class="w-10 h-10 rounded-lg flex items-center justify-center shrink-0" [ngClass]="{
                      'bg-[#DBEAFE] text-[#1D4ED8] dark:bg-[#1E3A8A] dark:text-[#BFDBFE]': resource.type === 'file',
                      'bg-[#D1FAE5] text-[#059669] dark:bg-[#14532D] dark:text-[#A7F3D0]': resource.type === 'link'
                    }">
            @if (resource.type === 'file') {
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            } @else {
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
            </svg>
            }
          </div>
          <div>
            <h4 class="font-medium text-[#0F172A] dark:text-[#F8FAFC]">{{ resource.title }}</h4>
            <p class="text-xs student-muted capitalize">{{ resource.type }}</p>
          </div>
        </a>
        }
        }
        } @else {
        <p class="text-sm student-muted italic px-2">No resources available for this lesson.</p>
        }
      </div>
    </div>
    } @empty {
    <div class="text-center py-12 student-card student-empty">
      <p class="student-muted">No lessons added to this class yet.</p>
    </div>
    }
  </div>
</div>
